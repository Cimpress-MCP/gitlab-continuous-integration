# using this will require buildcomponents.yaml 

build:
  image: kevinrambaud/node-flyway:8-5.1.4-alpine
  extends: .migrate
  stage: build
  services:
    - postgres:10.6-alpine
  after_script:
    - npm test
  coverage: '/All files\s*\|\s*[.?\d]+\s*\|\s*([0-9.]+)/'
  artifacts:
    paths:
      - coverage/
  variables:
    POSTGRES_DB: postgres
    POSTGRES_USER: postgres
    POSTGRES_SERVER: postgres
    POSTGRES_PASSWORD: ''